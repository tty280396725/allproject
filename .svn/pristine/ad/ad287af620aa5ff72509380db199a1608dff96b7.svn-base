<?php
namespace app\admin\controller;

use think\Db;

class Log extends Common
{
    function _initialize()
    {
        parent::_initialize(); // TODO: Change the autogenerated stub
    }

    public function index()
    {
        $where = [];
        if (input('get.search')){
            $where['a.route|a.id|u.username'] = ['like', '%'.input('get.search').'%'];
        }
        if (input('get._sort')){
            $order = explode(',', input('get._sort'));
            $order = $order[0].' '.$order[1];
        }else{
            $order = 'a.id desc';
        }

        $dataList = Db::table('tf_caozuo_log')->alias('a')->join('user u','a.uid = u.id')->where($where)->field('a.*,u.username')->order($order)->paginate('', false, page_param());

        $this->assign('dataList', $dataList);
        return $this->fetch();
    }

    public function clear(){

        $time = time() - 30*24*3600*3;
        Db::table('tf_caozuo_log')->where('create_time','<',$time) ->delete();

        return $this ->success('清除成功');
    }
}